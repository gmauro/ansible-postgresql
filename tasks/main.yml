# see https://www.debian.org/releases/ or http://releases.ubuntu.com/

- include: add_apt_repo.yml
  vars:
    distribution_codename: jessie
  when:
    - ansible_distribution == 'Debian'
    - ansible_distribution_version >= 8

- include: add_apt_repo.yml
  vars:
    distribution_codename: trusty
  when:
    - ansible_distribution == 'Ubuntu'
    - ansible_distribution_version == "14.04"

- include: add_apt_repo.yml
  vars:
    distribution_codename: xenial
  when:
    - ansible_distribution == 'Ubuntu'
    - ansible_distribution_version == "16.04"

- include: first_setup.yml

- include: install_packages.yml
  when: pg_install_server_packages

- include: db_cluster.yml
  when: pg_drop_db and pg_install_server_packages

- include: setup.yml
  become: yes
  become_method: su
  become_user: postgres
  when: pg_setup and pg_install_server_packages

- include: extend_conf.yml
  when: pg_extend and  pg_install_server_packages

- include: initialize.yml
  when: pg_initialize and sql_file_src_path and pg_install_server_packages

- include: cleaning.yml

- name: Ensure PostgreSQL is enabled and running
  service: name={{ pg_service_name }} enabled=yes state=started
  when: pg_install_server_packages
